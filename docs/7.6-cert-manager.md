# 8. Certificate Management (cert-manager)

### 8.1. Install cert-manager via Helm
```bash
kubectl create namespace cert-manager
helm repo add jetstack https://charts.jetstack.io
helm repo update
helm install cert-manager jetstack/cert-manager \
  --namespace cert-manager \
  --set crds.enabled=true
```
```text
NAME: cert-manager
LAST DEPLOYED: Mon Oct 27 14:09:07 2025
NAMESPACE: cert-manager
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
⚠️  WARNING: New default private key rotation policy for Certificate resources.
The default private key rotation policy for Certificate resources was
changed to `Always` in cert-manager >= v1.18.0.
Learn more in the [1.18 release notes](https://cert-manager.io/docs/releases/release-notes/release-notes-1.18).

cert-manager v1.19.1 has been deployed successfully!

In order to begin issuing certificates, you will need to set up a ClusterIssuer
or Issuer resource (for example, by creating a 'letsencrypt-staging' issuer).

More information on the different types of issuers and how to configure them
can be found in our documentation:

https://cert-manager.io/docs/configuration/

For information on how to configure cert-manager to automatically provision
Certificates for Ingress resources, take a look at the `ingress-shim`
documentation:

https://cert-manager.io/docs/usage/ingress/
```

kubectl get pods -n cert-manager
NAME                                       READY   STATUS    RESTARTS   AGE
cert-manager-77b74755d9-dsq9z              1/1     Running   0          69s
cert-manager-cainjector-65fcfd6ccf-rb7vh   1/1     Running   0          69s
cert-manager-webhook-9b4dd78-96lpx         1/1     Running   0          69s



### 8.2. Create Cloudflare API Secret
```bash
kubectl create secret generic cloudflare-api-token-secret \
  --from-literal=api-token="CF_API_TOKEN>" \
  -n cert-manager
```
secret/cloudflare-api-token-secret created


### 8.3. Configure ClusterIssuer for Let's Encrypt
```bash
kubectl describe clusterissuer letsencrypt-prod
```
```text
Name:         letsencrypt-prod
Namespace:    
Labels:       <none>
Annotations:  <none>
API Version:  cert-manager.io/v1
Kind:         ClusterIssuer
Metadata:
  Creation Timestamp:  2025-10-27T13:12:22Z
  Generation:          1
  Resource Version:    14845
  UID:                 2ed7757c-e961-49b6-ba2c-84a315c84323
Spec:
  Acme:
    Email:  oleh.kondracki@gmail.com
    Private Key Secret Ref:
      Name:  letsencrypt-prod-account-key
    Server:  https://acme-v02.api.letsencrypt.org/directory
    Solvers:
      dns01:
        Cloudflare:
          API Token Secret Ref:
            Key:   api-token
            Name:  cloudflare-api-token-secret
          Email:   admin@marketflow.ai
Status:
  Acme:
    Last Private Key Hash:  C6BAMpxCjTucmR42WHmlUkIzTO7ZtT1F5XbbcELlvGg=
    Last Registered Email:  oleh.kondracki@gmail.com
  Conditions:
    Last Transition Time:  2025-10-27T13:12:23Z
    Message:               The ACME account was registered with the ACME server
    Observed Generation:   1
    Reason:                ACMEAccountRegistered
    Status:                True
    Type:                  Ready
Events:                    <none>
```

